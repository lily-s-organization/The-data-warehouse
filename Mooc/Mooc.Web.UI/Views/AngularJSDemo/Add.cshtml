
@model Mooc.DataAccess.Models.Entities.User
<script src="~/Scripts/angular1.7/angular.js"></script>

<div id="dataBind" ng-app="myapp" ng-controller="myCtrl">

   

    <form name="myForm" ng-submit="submitForm(userForm.$valid)">
        <table class="table">
            <tr>
                <td>User</td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td><b>UserName</b></td>
                <td>
                    <input type="text" name="usernameInput" class="form-control" ng-model="UserName" required />
                    <span ng-show="myForm.usernameInput.$touched && myForm.usernameInput.$invalid" class="help-block">UserName Required</span>
                </td>
                <td><b>Email</b></td>
                <td>
                    <input name="emailInput" type="email" class="form-control" ng-model="Email" required />
                    <span ng-show="myForm.emailInput.$touched && myForm.emailInput.$invalid" class="help-block">Wrong Format</span>

                </td>
            </tr>
            <tr>
                
                <td><b>Password</b></td>
                <td>
                    <input type="password" class="form-control" ng-model="PassWord" ng-minlength="6" name="passwordInput" required />
                    <span ng-show="myForm.passwordInput.$touched && myForm.passwordInput.$invalid" class="help-block">At least 6 letters</span>
                </td>
                <td><b>Confirm Password</b></td>
                <td>
                    <input type="password" class="form-control" ng-model="ConfirmPassWord" ng-minlength="6" name="confirmpasswordInput" required />
                    <span ng-show="myForm.confirmpasswordInput.$touched && myForm.confirmpasswordInput.$invalid" class="help-block">At least 6 letters</span>
                    <span>{{errorMsg}}</span>
                </td>
               
            </tr>
            <tr>
                <td><b>Role</b></td>
                <td>
                    <select ng-model="selectedName" ng-options="x.Text for x in names" name="roletypeInput" required>
                        <option value="">请选择</option>
                    </select>
                    <span ng-show="myForm.roletypeInput.$touched && myForm.roletypeInput.$invalid" class="help-block">please select one role</span>
                </td>
                <td></td>
                <td></td>
            </tr>


            <tr>
                <td></td>
                <td></td>
                <td></td>
                <td>
                    <input type="submit" class="btn btn-primary" value="Save" ng-click="Save(PassWord,ConfirmPassWord)" ng-disabled="myForm.$invalid" />
                    <input type="button" class="btn btn-danger" value="Cancel" ng-click="Cancel()" />
                </td>

            </tr>
        </table>
    </form>

</div>


<script>

    var app = angular.module("myapp", []);
    app.controller("myCtrl", function ($scope, $http) {
   
        getRoleTypeList($scope, $http);//初始化下拉列表

        $scope.Save = function (PassWord, ConfirmPassWord) {
            if (PassWord == ConfirmPassWord) {
                saveUser($scope, $http);
            }
            else {
                window.alert("check your password again");
            }
        };

        $scope.Cancel = function () {
            window.location.href = "@Url.Content("~/AngularJSDemo/Index/")";
        };



    });



    function getRoleTypeList($scope, $http) {
       
        $http({
            method: 'GET',
            url: "@Url.Content("~/AngularJSDemo/GetRoleTypeList")",
        }).then(function (response) {
            if (response.status == 200) {
                $scope.names = response.data.data;           

            }
        }, function (data) {
            console.log(data);
        });
    }


    function saveUser($scope, $http) {

        var user = {
            UserName: $scope.UserName,
            Email: $scope.Email,
            PassWord: $scope.PassWord,
            RoleType: $scope.selectedName.Value,
          
        };

        $http({
            method: 'POST',
            url: "@Url.Content("~/AngularJSDemo/AddUserList")",
            data: JSON.stringify(user),
            dataType: "json"
        }).then(function (response) {
            if (response.status == 200) {
                window.location.href = "@Url.Content("~/AngularJSDemo/Index/")";
            }
        }, function (data) {
            console.log(data);
        });
    }


</script>

