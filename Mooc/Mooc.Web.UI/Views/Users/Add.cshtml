@model Mooc.DataAccess.Models.Entities.User
@{
    ViewBag.Title = "Add";
}

<body>


    <div class="form-horizontal">
        <div class="form-group">
            <label class="col-sm-2 control-label">用户名</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="UserName"
                       placeholder="请输入用户名" maxlength="50">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">密码</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="PassWord"
                       placeholder="请输入密码">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">确认密码</label>
            <div class="col-sm-10">
                <input type="password" class="form-control" id="confirmPassWord"
                       placeholder="请确认密码">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">邮箱</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="email"
                       placeholder="请输入邮箱" maxlength="50">
            </div>
        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">头像</label>
            <div class="col-sm-10">
                <input type="text" class="form-control" id="PhotoUrl"
                       placeholder="请输入图片路径" maxlength="50">
            </div>
        </div>


        <div class="form-group">
            <label class="col-sm-2 control-label">用户类型</label>
            <div class="col-sm-10">

                @Html.DropDownListFor(m => m.RoleType, ViewData["RoleType"] as List<SelectListItem>, "---请选择---", new { @class = "form-control", @id = "roleType" })

            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-offset-2 col-sm-10">
                <button onclick="Add()" class="btn btn-default">提交</button>
            </div>
        </div>
    </div>

    <script src="~/Scripts/Script.js"></script>
</body>

<script>
    function Add() {
        var username = $("#UserName").val();
        if (!username) {
            alert("user can't be empty");
            return false;
        }
        var password = $("#PassWord").val();
        if (!password) {
            alert("password can't be empty");
            return false;
        }
        if (password.length < 6) {
            alert("password should be at least 6 letters");
            return false;
        }
        var roleType = $("#roleType").val();
        if (!roleType) {
            alert("roleType can't be empty");
            return false;
        }
        
        var photoUrl = $("#PhotoUrl").val();

        var confirmPassWord = $("#confirmPassWord").val();
        if (!confirmPassWord ) {
            alert("Re-type password");
            return false;
        }
        if (confirmPassWord != password) {
            alert("Please confirm your password again");
            return false;
        }
        var email = $("#email").val();
        if (!email) {
            alert("email can't be empty");
            return false;
        }

        TestEmail(email);



        $.ajax({
            url: "@Url.Content("~/Users/AddUserList")",
            data: { "UserName": username, "PassWord": password, "RoleType": roleType, "Email": email, "PhotoUrl": photoUrl},
            dataType: 'json', type: "POST",
            success: function (result) {
                if (result == 0 ) {
                    window.location.href="@Url.Content("~/Users/Index")"//return controller
                } else {
                    alert("failed add");

                }

            }
        });
    }
</script>